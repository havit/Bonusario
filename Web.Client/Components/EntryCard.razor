<div>
	@if ((Entry is not null) && EmployeesDataStore.IsLoaded)
	{
		<EditForm EditContext="editContext">
			<FluentValidationValidator />
			<HxFormState Enabled="@(Entry.Submitted is null)">
				<HxCard>
					<BodyTemplate>
						<div class="row g-4">
							@if (!RecipientLocked)
							{
								<div class="col-lg-8">
									<EmployeePicker @bind-Value="Entry.RecipientId" ExcludeCurrentEmployee="true" />
								</div>
							}
							else if (Entry.RecipientId.HasValue)
							{
								<div class="col-lg-8 d-flex align-items-center">
									<h5 class="mb-0">@(RenderAuthor ? "pro " : null) @EmployeesDataStore.GetByKey(Entry.RecipientId.Value).Name

                                    @if (RenderAuthor)
									{
										@(" od ") @EmployeesDataStore.GetByKey(Entry.CreatedById.Value).Name
									}

                                    </h5>
								</div>
							}
                                
							<div class="col-lg-4">
								<HxInputNumber @bind-Value="@Entry.Value" />
							</div>
							<div class="col-lg-12">
                                <HxInputTextArea Placeholder="@(Entry.Submitted is null ? "Oceňuji... (volitelný text)" : null)" @bind-Value="@Entry.Text" />
							</div>
							<div class="@(Entry.Created is null ? "col-lg-5" : "col-lg-6")">
								<HxSelect @bind-Value="Entry.Visibility" Nullable="false" AutoSort="false" TextSelector="v => EnumExt.GetDescription(typeof(EntryVisibility), v)" Data="Enum.GetValues<EntryVisibility>()">
                                    <InputGroupStartTemplate>
                                        @if (SettingDefaultEntryVisibilityEnabled)
										{
											<HxPopover
												Content="@(DefaultSelected ? "Nastaveno jako výchozí" : "Nastavit jako výchozí")"
												Trigger="PopoverTrigger.Hover"
												Placement="PopoverPlacement.Top"
												@ref="popover">

												<HxButton
													OnClick="SetDefaultEntryVisibility"
													CssClass="no-right-round-corners"
													Color="ThemeColor.Light"
													Icon="@BootstrapIcon.Gear"
													Enabled="!DefaultSelected" />

											</HxPopover>
										}
									</InputGroupStartTemplate>
								</HxSelect>
							</div>
							<div class="col-lg-12">
								<EntryTagsPicker @bind-Value="Entry.Tags" />
							</div>
						</div>
						@if (Entry.Created is not null)
						{
							<small class="text-muted">vloženo @Entry.Created.Value.ToShortDateString()</small>
						}
						@if (Entry.Submitted is null)
						{
							<div class="d-flex">
								@if (Entry.Id != default)
								{
									@* <small class="text-muted">koncept</small> *@
									<HxButton Icon="BootstrapIcon.Trash" 
											Color="ThemeColor.Light" 
											Size="ButtonSize.Small"
											CssClass="ms-auto"
											OnClick="HandleDeleteClick" />
								}
								else
								{
									@* <small class="text-muted">nový</small> *@
									<HxButton Color="ThemeColor.Primary"
											OnValidClick="HandleNewClick"
											CssClass="ms-auto"
											Text="Přidat" />
								}
							</div>
						}
					</BodyTemplate>
				</HxCard>
			</HxFormState>
		</EditForm>
	}
</div>